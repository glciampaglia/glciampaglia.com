<raw-content>
	<span></span>
	<script>
		this.root.innerHTML = opts.content;
		this.on('update', function() { 
			this.root.innerHTML = opts.content;
		});
	</script>
</raw-content>

<instructions-view>
	<div>
		<div class='c instruct'><raw-content content={content} /></div>
		<footer>
			<div><button if={showPrev} onclick={opts.prev}>Prev</button>&nbsp;</div>
			<div>&nbsp;<button if={showNext} onclick={opts.next}>Next</button></div>
		</footer>
	</div>
	<script>
		var tag = this;
		var converter = Markdown.getSanitizingConverter();
		content = converter.makeHtml(opts.content);
		tag.showPrev = !opts.hidePrev;
		tag.showNext = !opts.hideNext;
	</script>

	<style>
		.instruct, raw-content {width: 850px; }
		button {font-size: 24px; padding: 5px 15px; }
		footer {display: flex; flex-direction: row; justify-content: space-between; padding-top: 40px;}
	</style>
</instructions-view>


<exhibit-view>
	<svg width="800" height="600" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
		<rect width="800" height="600" x="0" y="0" style="stroke: green; fill:rgb(255,255,255);" />

		<line x1="400" y1="0" x2="400" y2="600" stroke="black" />
		<line x1="0" y1="300" x2="800" y2="300" stroke="black" />

		<line x1="50" y1="290" x2="50" y2="310" stroke="green" />
		<line x1="100" y1="290" x2="100" y2="310" stroke="green" />
		<line x1="150" y1="290" x2="150" y2="310" stroke="green" />
		<line x1="200" y1="290" x2="200" y2="310" stroke="green" />
		<line x1="250" y1="290" x2="250" y2="310" stroke="green" />
		<line x1="300" y1="290" x2="300" y2="310" stroke="green" />
		<line x1="350" y1="290" x2="350" y2="310" stroke="green" />

		<line x1="450" y1="290" x2="450" y2="310" stroke="green" />
		<line x1="500" y1="290" x2="500" y2="310" stroke="green" />
		<line x1="550" y1="290" x2="550" y2="310" stroke="green" />
		<line x1="600" y1="290" x2="600" y2="310" stroke="green" />
		<line x1="650" y1="290" x2="650" y2="310" stroke="green" />
		<line x1="700" y1="290" x2="700" y2="310" stroke="green" />
		<line x1="750" y1="290" x2="750" y2="310" stroke="green" />

		<line x1="390" y1="50" x2="410" y2="50" stroke="green" />
		<line x1="390" y1="100" x2="410" y2="100" stroke="green" />
		<line x1="390" y1="150" x2="410" y2="150" stroke="green" />
		<line x1="390" y1="200" x2="410" y2="200" stroke="green" />
		<line x1="390" y1="250" x2="410" y2="250" stroke="green" />

		<line x1="390" y1="350" x2="410" y2="350" stroke="green" />
		<line x1="390" y1="400" x2="410" y2="400" stroke="green" />
		<line x1="390" y1="450" x2="410" y2="450" stroke="green" />
		<line x1="390" y1="500" x2="410" y2="500" stroke="green" />
		<line x1="390" y1="550" x2="410" y2="550" stroke="green" />


		<image xlink:href={nw} height="200" width="200" x="100" y="50"/>
		<image xlink:href={ne} height="200" width="200" x="500" y="50"/>
		<image xlink:href={sw} height="200" width="200" x="100" y="350"/>
		<image xlink:href={se} height="200" width="200" x="500" y="350"/>

		<rect width="398" height="298" x="1" y="1" 
			style="fill:rgb(255,255,255,0);" class={qsel:selected=='nw'}
			ondragstart={clickNW} onmousedown={clickNW} />

		<rect width="398" height="298" x="401" y="1" 
		style="fill:rgb(255,255,255,0);" class={qsel:selected=='ne'}
		ondragstart={clickNE} onmousedown={clickNE} />

		<rect width="398" height="298" x="1" y="301" 
			style="fill:rgb(255,255,255,0);" class={qsel:selected=='sw'}
			ondragstart={clickSW} onmousedown={clickSW} />

		<rect width="398" height="298" x="401" y="301" 
			style="fill:rgb(255,255,255,0);" class={qsel:selected=='se'}
			ondragstart={clickSE} onmousedown={clickSE} />

	</svg>

	<script>
		var tag = this;
		tag.nw = 'blank.gif';
		tag.ne = 'blank.gif';
		tag.sw = 'blank.gif';
		tag.se = 'blank.gif';
		tag.selected = opts.selected;
		
		var t = opts.trial;
		if(t){
			tag[t.quadrant] = t.value;
		}

		clickNW(e){
			tag.opts.clicked('nw');
		}
		clickNE(e){
			tag.opts.clicked('ne');
		}
		clickSW(e){
			tag.opts.clicked('sw');
		}
		clickSE(e){
			tag.opts.clicked('se');
		}
	</script>

	<style>	
		.qsel {fill:rgba(150,150,50,0.05)!important; stroke:orange; stroke-width: 1px;}
	</style>
</exhibit-view>

<score-view>
	<h2>Your performance on simulation {opts.sim}:</h2>
	<div class='txt'>Hit Rate: {hitPct}%</div>
	<div class='txt'>False Alarm Rate: {faPct}%</div>
	<div class='action'><button onclick={opts.next}>Next</button></div>

	<script>
		var tag = this;
		tag.hitPct = '';
		tag.faPct = '';

		function pctFormat(num){
			if(num == NaN){
				return 0;
			} else {
				return parseFloat(Math.round(num * 100) / 100).toFixed(0);
			}
		}
		if (opts.logs.length > 0){
			var score = {length: opts.logs.length, signals: 0, noises: 0, hits: 0, fas: 0};
			opts.logs.forEach(function(l){
				if (l.type == 'signal') {
					score.signals += 1;
				} else { //if (l.type == 'noise'){
					score.noises +=1;
				}

				if (l.result == 'hit') {
					score.hits += 1;
				} else if (l.result == 'false alarm'){
					score.fas +=1;
				}
			});

			tag.hitPct = pctFormat((100 * score.hits) / score.signals);
			tag.faPct = pctFormat((100 * score.fas) / score.noises);
		}

	</script>

	<style>
		.txt {width: 600px; text-align: left;}
		.action {padding-top: 40px;}
	</style>
</score-view>


<end-view>
	<div>
		<div class='c instruct'>
			This exercise is complete. If you would like to restart the exercise, click the button below. <br/>
			<button onclick={opts.restart}>Restart</button>
		</div>
	</div>
	<style>
		.instruct {width: 850px; }
		button {font-size: 24px; padding: 5px 15px; }
	</style>
</end-view>